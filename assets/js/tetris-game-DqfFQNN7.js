import{r as a,u as H,j as s}from"./vendor-react-BnsUgT_O.js";const x=10,m=20,Y=25,C={I:{shape:[[1,1,1,1]],color:"#00f0f0",type:1},J:{shape:[[1,0,0],[1,1,1]],color:"#0000f0",type:2},L:{shape:[[0,0,1],[1,1,1]],color:"#f0a000",type:3},O:{shape:[[1,1],[1,1]],color:"#f0f000",type:4},S:{shape:[[0,1,1],[1,1,0]],color:"#00f000",type:5},T:{shape:[[0,1,0],[1,1,1]],color:"#a000f0",type:6},Z:{shape:[[1,1,0],[0,1,1]],color:"#f00000",type:7}},J=()=>{const p=a.useRef(null),[t,y]=a.useState({board:Array(m).fill(null).map(()=>Array(x).fill(0)),currentPiece:null,nextPiece:v(),score:0,level:1,lines:0,gameOver:!1}),[o,b]=a.useState(!1),T=H(),L=a.useRef(),M=a.useRef(0),k=a.useRef(0),N=a.useRef(1e3),[h,_]=a.useState(Y),g=a.useRef(null);function v(){const e=Object.values(C),r=e[Math.floor(Math.random()*e.length)];return{shape:r.shape,type:r.type}}const j=a.useCallback(()=>{y({board:Array(m).fill(null).map(()=>Array(x).fill(0)),currentPiece:{shape:v().shape,x:Math.floor(x/2)-1,y:0,type:v().type},nextPiece:v(),score:0,level:1,lines:0,gameOver:!1}),b(!1),N.current=1e3},[]),R=a.useCallback(()=>{const e=p.current,r=e==null?void 0:e.getContext("2d");if(!(!r||!e)&&(r.fillStyle="#000000",r.fillRect(0,0,e.width,e.height),t.board.forEach((c,n)=>{c.forEach((i,u)=>{if(i!==0){const d=Object.values(C).find(w=>w.type===i);d&&(r.fillStyle=d.color,r.fillRect(u*h,n*h,h-1,h-1))}})}),t.currentPiece)){const c=Object.values(C).find(n=>{var i;return n.type===((i=t.currentPiece)==null?void 0:i.type)});c&&(r.fillStyle=c.color,t.currentPiece.shape.forEach((n,i)=>{n.forEach((u,d)=>{u!==0&&r.fillRect((t.currentPiece.x+d)*h,(t.currentPiece.y+i)*h,h-1,h-1)})}))}},[t,h]),S=a.useCallback(e=>{for(let r=0;r<e.shape.length;r++)for(let c=0;c<e.shape[r].length;c++)if(e.shape[r][c]!==0){const n=e.x+c,i=e.y+r;if(n<0||n>=x||i>=m||i>=0&&t.board[i][n]!==0)return!0}return!1},[t.board]),P=a.useCallback(e=>{const r=e.shape[0].map((n,i)=>e.shape.map(u=>u[i]).reverse()),c={...e,shape:r};S(c)||y(n=>({...n,currentPiece:c}))},[S]),f=a.useCallback(e=>{if(!t.currentPiece||t.gameOver||o)return;const r={...t.currentPiece};if(e==="left"&&(r.x-=1),e==="right"&&(r.x+=1),e==="down"&&(r.y+=1),!S(r))y(c=>({...c,currentPiece:r}));else if(e==="down"){const c=[...t.board];t.currentPiece.shape.forEach((l,E)=>{l.forEach((G,W)=>{if(G!==0){const A=t.currentPiece.y+E;A>=0&&(c[A][t.currentPiece.x+W]=t.currentPiece.type)}})});let n=0;for(let l=m-1;l>=0;l--)c[l].every(E=>E!==0)&&(c.splice(l,1),c.unshift(Array(x).fill(0)),n++,l++);const i=t.score+n*100*t.level,u=t.lines+n,d=Math.floor(u/10)+1,w=c[0].some(l=>l!==0);if(w){const l=JSON.parse(localStorage.getItem("tetrisHistory")||"[]");l.push({score:i,lines:u,level:d,date:new Date().toLocaleString()}),localStorage.setItem("tetrisHistory",JSON.stringify(l))}y(l=>({...l,board:c,currentPiece:w?null:{...l.nextPiece,x:Math.floor(x/2)-1,y:0},nextPiece:v(),score:i,lines:u,level:d,gameOver:w})),N.current=Math.max(100,1e3-(d-1)*100)}},[t,S,o]),O=a.useCallback(e=>{if(!t.gameOver)switch(e.code){case"ArrowLeft":f("left");break;case"ArrowRight":f("right");break;case"ArrowDown":f("down");break;case"ArrowUp":t.currentPiece&&P(t.currentPiece);break;case"Space":b(r=>!r);break}},[t.gameOver,t.currentPiece,f,P]),z=a.useCallback(e=>{if(t.gameOver||o)return;e.preventDefault();const r=e.touches[0];g.current={x:r.clientX,y:r.clientY}},[t.gameOver,o]),B=a.useCallback(e=>{e.preventDefault()},[]),D=a.useCallback(e=>{if(!g.current||t.gameOver||o)return;e.preventDefault();const r=e.changedTouches[0],c=r.clientX-g.current.x,n=r.clientY-g.current.y,i=20;(Math.abs(c)>i||Math.abs(n)>i)&&(Math.abs(c)>Math.abs(n)?c>0?f("right"):f("left"):n<0?t.currentPiece&&P(t.currentPiece):f("down")),g.current=null},[t.currentPiece,t.gameOver,o,f,P]),I=a.useCallback(e=>{const r=e-M.current;M.current=e,!o&&!t.gameOver&&(k.current+=r,k.current>N.current&&(f("down"),k.current=0)),R(),L.current=requestAnimationFrame(I)},[R,t.gameOver,o,f]);return a.useEffect(()=>{const e=()=>{const r=p.current;if(!r)return;const c=Math.min(window.innerWidth*.9,500),n=window.innerHeight*.7,i=Math.floor(c/x),u=Math.floor(n/m),d=Math.min(i,u);_(d),r.width=d*x,r.height=d*m};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),a.useEffect(()=>{const e=p.current;e&&(e.width=h*x,e.height=h*m),j()},[j,h]),a.useEffect(()=>(window.addEventListener("keydown",O),()=>{window.removeEventListener("keydown",O)}),[O]),s.jsxs("div",{className:"tetris-container",onTouchStart:z,onTouchMove:B,onTouchEnd:D,style:{touchAction:"none",WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none",width:"100%",height:"100%"},children:[s.jsx("canvas",{ref:p,width:x*h,height:m*h,style:{touchAction:"none"}}),s.jsxs("div",{className:"game-header",children:[s.jsx("h1",{children:"Tetris"}),s.jsxs("div",{className:"score-container",children:[s.jsxs("div",{className:"score-box",children:["Score: ",t.score]}),s.jsxs("div",{className:"score-box",children:["Level: ",t.level]}),s.jsxs("div",{className:"score-box",children:["Lines: ",t.lines]})]})]}),s.jsxs("div",{className:"game-controls",children:[s.jsx("button",{onClick:j,children:"New Game"}),s.jsx("button",{onClick:()=>T("/tetris/history"),children:"History"}),s.jsx("button",{onClick:()=>T("/"),children:"Back to Home"})]}),t.gameOver&&s.jsxs("div",{className:"game-over",children:[s.jsx("h2",{children:"Game Over!"}),s.jsxs("p",{children:["Score: ",t.score]}),s.jsx("button",{onClick:j,children:"Play Again"})]})]})},K=Object.freeze(Object.defineProperty({__proto__:null,default:J},Symbol.toStringTag,{value:"Module"})),X=()=>{const[p,t]=a.useState([]),y=H();return a.useEffect(()=>{const o=localStorage.getItem("tetrisHistory");o&&t(JSON.parse(o))},[]),s.jsx("div",{className:"min-h-screen bg-gray-100 py-8 px-4",children:s.jsxs("div",{className:"max-w-4xl mx-auto",children:[s.jsxs("div",{className:"flex justify-between items-center mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Tetris History"}),s.jsx("button",{onClick:()=>y("/tetris"),className:"px-4 py-2 bg-gray-800 text-white rounded hover:bg-gray-700",children:"Back to Game"})]}),s.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:s.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Score"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Lines"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Level"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.map((o,b)=>s.jsxs("tr",{children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:o.date}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:o.score}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:o.lines}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:o.level})]},b))})]})})]})})},U=Object.freeze(Object.defineProperty({__proto__:null,default:X},Symbol.toStringTag,{value:"Module"}));export{U as h,K as i};
//# sourceMappingURL=tetris-game-DqfFQNN7.js.map
