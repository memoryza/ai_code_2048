import{r as c,u as T,j as r}from"./vendor-react-BnsUgT_O.js";const f=10,x=20,I=25,C={I:{shape:[[1,1,1,1]],color:"#00f0f0",type:1},J:{shape:[[1,0,0],[1,1,1]],color:"#0000f0",type:2},L:{shape:[[0,0,1],[1,1,1]],color:"#f0a000",type:3},O:{shape:[[1,1],[1,1]],color:"#f0f000",type:4},S:{shape:[[0,1,1],[1,1,0]],color:"#00f000",type:5},T:{shape:[[0,1,0],[1,1,1]],color:"#a000f0",type:6},Z:{shape:[[1,1,0],[0,1,1]],color:"#f00000",type:7}},D=()=>{const m=c.useRef(null),[t,p]=c.useState({board:Array(x).fill(null).map(()=>Array(f).fill(0)),currentPiece:null,nextPiece:g(),score:0,level:1,lines:0,gameOver:!1}),[l,w]=c.useState(!1),R=T(),b=c.useRef(),A=c.useRef(0),P=c.useRef(0),N=c.useRef(1e3),[d,_]=c.useState(I);function g(){const e=Object.values(C),s=e[Math.floor(Math.random()*e.length)];return{shape:s.shape,type:s.type}}const j=c.useCallback(()=>{p({board:Array(x).fill(null).map(()=>Array(f).fill(0)),currentPiece:{shape:g().shape,x:Math.floor(f/2)-1,y:0,type:g().type},nextPiece:g(),score:0,level:1,lines:0,gameOver:!1}),w(!1),N.current=1e3},[]),H=c.useCallback(()=>{const e=m.current,s=e==null?void 0:e.getContext("2d");if(!(!s||!e)&&(s.fillStyle="#000000",s.fillRect(0,0,e.width,e.height),t.board.forEach((a,n)=>{a.forEach((i,u)=>{if(i!==0){const h=Object.values(C).find(v=>v.type===i);h&&(s.fillStyle=h.color,s.fillRect(u*d,n*d,d-1,d-1))}})}),t.currentPiece)){const a=Object.values(C).find(n=>{var i;return n.type===((i=t.currentPiece)==null?void 0:i.type)});a&&(s.fillStyle=a.color,t.currentPiece.shape.forEach((n,i)=>{n.forEach((u,h)=>{u!==0&&s.fillRect((t.currentPiece.x+h)*d,(t.currentPiece.y+i)*d,d-1,d-1)})}))}},[t,d]),S=c.useCallback(e=>{for(let s=0;s<e.shape.length;s++)for(let a=0;a<e.shape[s].length;a++)if(e.shape[s][a]!==0){const n=e.x+a,i=e.y+s;if(n<0||n>=f||i>=x||i>=0&&t.board[i][n]!==0)return!0}return!1},[t.board]),L=c.useCallback(e=>{const s=e.shape[0].map((n,i)=>e.shape.map(u=>u[i]).reverse()),a={...e,shape:s};S(a)||p(n=>({...n,currentPiece:a}))},[S]),y=c.useCallback(e=>{if(!t.currentPiece||t.gameOver||l)return;const s={...t.currentPiece};if(e==="left"&&(s.x-=1),e==="right"&&(s.x+=1),e==="down"&&(s.y+=1),!S(s))p(a=>({...a,currentPiece:s}));else if(e==="down"){const a=[...t.board];t.currentPiece.shape.forEach((o,E)=>{o.forEach((z,B)=>{if(z!==0){const M=t.currentPiece.y+E;M>=0&&(a[M][t.currentPiece.x+B]=t.currentPiece.type)}})});let n=0;for(let o=x-1;o>=0;o--)a[o].every(E=>E!==0)&&(a.splice(o,1),a.unshift(Array(f).fill(0)),n++,o++);const i=t.score+n*100*t.level,u=t.lines+n,h=Math.floor(u/10)+1,v=a[0].some(o=>o!==0);if(v){const o=JSON.parse(localStorage.getItem("tetrisHistory")||"[]");o.push({score:i,lines:u,level:h,date:new Date().toLocaleString()}),localStorage.setItem("tetrisHistory",JSON.stringify(o))}p(o=>({...o,board:a,currentPiece:v?null:{...o.nextPiece,x:Math.floor(f/2)-1,y:0},nextPiece:g(),score:i,lines:u,level:h,gameOver:v})),N.current=Math.max(100,1e3-(h-1)*100)}},[t,S,l]),k=c.useCallback(e=>{if(!t.gameOver)switch(e.code){case"ArrowLeft":y("left");break;case"ArrowRight":y("right");break;case"ArrowDown":y("down");break;case"ArrowUp":t.currentPiece&&L(t.currentPiece);break;case"Space":w(s=>!s);break}},[t.gameOver,t.currentPiece,y,L]),O=c.useCallback(e=>{const s=e-A.current;A.current=e,!l&&!t.gameOver&&(P.current+=s,P.current>N.current&&(y("down"),P.current=0)),H(),b.current=requestAnimationFrame(O)},[H,t.gameOver,l,y]);return c.useEffect(()=>{const e=()=>{const s=m.current;if(!s)return;const a=Math.min(window.innerWidth*.9,500),n=window.innerHeight*.7,i=Math.floor(a/f),u=Math.floor(n/x),h=Math.min(i,u);_(h),s.width=h*f,s.height=h*x};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),c.useEffect(()=>{const e=m.current;e&&(e.width=d*f,e.height=d*x),j()},[j,d]),c.useEffect(()=>(window.addEventListener("keydown",k),b.current=requestAnimationFrame(O),()=>{window.removeEventListener("keydown",k),b.current&&cancelAnimationFrame(b.current)}),[k,O]),r.jsxs("div",{className:"game-container",children:[r.jsxs("div",{className:"game-header",children:[r.jsx("h1",{children:"Tetris"}),r.jsxs("div",{className:"score-container",children:[r.jsxs("div",{className:"score-box",children:["Score: ",t.score]}),r.jsxs("div",{className:"score-box",children:["Level: ",t.level]}),r.jsxs("div",{className:"score-box",children:["Lines: ",t.lines]})]})]}),r.jsxs("div",{className:"game-controls",children:[r.jsx("button",{onClick:j,children:"New Game"}),r.jsx("button",{onClick:()=>R("/tetris/history"),children:"History"}),r.jsx("button",{onClick:()=>R("/"),children:"Back to Home"})]}),r.jsx("canvas",{ref:m,className:"game-canvas"}),t.gameOver&&r.jsxs("div",{className:"game-over",children:[r.jsx("h2",{children:"Game Over!"}),r.jsxs("p",{children:["Score: ",t.score]}),r.jsx("button",{onClick:j,children:"Play Again"})]})]})},q=Object.freeze(Object.defineProperty({__proto__:null,default:D},Symbol.toStringTag,{value:"Module"})),G=()=>{const[m,t]=c.useState([]),p=T();return c.useEffect(()=>{const l=localStorage.getItem("tetrisHistory");l&&t(JSON.parse(l))},[]),r.jsx("div",{className:"min-h-screen bg-gray-100 py-8 px-4",children:r.jsxs("div",{className:"max-w-4xl mx-auto",children:[r.jsxs("div",{className:"flex justify-between items-center mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Tetris History"}),r.jsx("button",{onClick:()=>p("/tetris"),className:"px-4 py-2 bg-gray-800 text-white rounded hover:bg-gray-700",children:"Back to Game"})]}),r.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Score"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Lines"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Level"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map((l,w)=>r.jsxs("tr",{children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:l.date}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:l.score}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:l.lines}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:l.level})]},w))})]})})]})})},F=Object.freeze(Object.defineProperty({__proto__:null,default:G},Symbol.toStringTag,{value:"Module"}));export{F as h,q as i};
//# sourceMappingURL=tetris-game-B5Zv5zvf.js.map
